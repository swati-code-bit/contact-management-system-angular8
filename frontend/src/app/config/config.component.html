<div class="container">
  <h2>Enter JSON Structure to Generate Form</h2>

  <textarea
    [(ngModel)]="jsonInput"
    rows="10"
    cols="50"
    placeholder="Enter JSON form structure here"
  ></textarea>
  <br />
  <button (click)="generateForm()">Generate Form</button>

  <div *ngIf="showPreview && formFields.length > 0">
    <h2>Form Preview (Generated from JSON)</h2>
    <form [formGroup]="form" (ngSubmit)="submitContact()">
      <div *ngFor="let field of formFields" class="form-field">
        <label [for]="field.name">{{ field.label }}:</label>

        <!-- Dynamic input fields -->
        <ng-container *ngIf="['text', 'email', 'number', 'url'].includes(field.type)">
          <input
            [type]="field.type"
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder || ''"
            class="form-control"
          />
        </ng-container>

        <ng-container *ngIf="field.type === 'password'">
          <input
            type="password"
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder || ''"
            class="form-control"
          />
        </ng-container>

        <ng-container *ngIf="field.type === 'checkbox'">
          <input
            type="checkbox"
            [id]="field.name"
            [formControlName]="field.name"
            class="form-checkbox"
          />
        </ng-container>

        <ng-container *ngIf="field.type === 'radio'">
          <div class="radio-group">
            <div *ngFor="let option of field.options" class="radio-option">
              <input
                type="radio"
                [id]="field.name + '_' + option"
                [formControlName]="field.name"
                [value]="option"
                class="form-radio"
              />
              <label [for]="field.name + '_' + option">{{ option }}</label>
            </div>
          </div>
        </ng-container>

        <ng-container *ngIf="field.type === 'select'">
          <select
            [id]="field.name"
            [formControlName]="field.name"
            class="form-select"
          >
            <option value="">Select an option</option>
            <option *ngFor="let option of field.options" [value]="option">
              {{ option }}
            </option>
          </select>
        </ng-container>

        <ng-container *ngIf="field.type === 'textarea'">
          <textarea
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder || ''"
            class="form-textarea"
          ></textarea>
        </ng-container>

        <div *ngIf="form.get(field.name)?.invalid && form.get(field.name)?.touched" class="error-message">
          {{ getErrorMessage(field.name) }}
        </div>
      </div>

      <button type="submit">Submit</button>
    </form>
  </div>

  <!-- Form Name and Save Button -->
  <div>
    <label for="formName">Form Name:</label>
    <input type="text" [(ngModel)]="formName" placeholder="Enter Form Name" />
    <button (click)="saveForm()">Save Form</button>
  </div>

  <hr />

  <!-- Select Form Section -->
  <h2>Select Form</h2>
  <label for="formSelect">Select Form:</label>
  <select id="formSelect" [(ngModel)]="selectedFormId" (change)="onFormSelectChange()">
    <option *ngFor="let form of formNames" [value]="form._id">
      {{ form.formName }}
    </option>
  </select>

  <button (click)="setForm()">Set Form</button>

  <div *ngIf="selectedFormId">
    <h3>Selected Form:</h3>
    <p><strong>Form ID:</strong> {{ selectedFormId }}</p>
    <p><strong>Form Name:</strong> {{ formName }}</p>
  </div>

  <!-- Generate Selected Set Form Button -->
  <button (click)="handleGeneratedForm()">Generate Selected Set Form</button>

  <!-- Preview of the form generated by selected ID -->
  <div *ngIf="formFields.length > 0 && selectedFormId && showPreviewForSelected">
    <h2>Form Preview (Generated from Selected Form)</h2>
    <form [formGroup]="form" (ngSubmit)="submitContact()">
      <div *ngFor="let field of formFields" class="form-field">
        <label [for]="field.name">{{ field.label }}:</label>

        <ng-container *ngIf="['text', 'email', 'number', 'url'].includes(field.type)">
          <input
            [type]="field.type"
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder || ''"
            class="form-control"
          />
        </ng-container>

        <ng-container *ngIf="field.type === 'password'">
          <input
            type="password"
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder || ''"
            class="form-control"
          />
        </ng-container>

        <ng-container *ngIf="field.type === 'checkbox'">
          <input
            type="checkbox"
            [id]="field.name"
            [formControlName]="field.name"
            class="form-checkbox"
          />
        </ng-container>

        <ng-container *ngIf="field.type === 'radio'">
          <div class="radio-group">
            <div *ngFor="let option of field.options" class="radio-option">
              <input
                type="radio"
                [id]="field.name + '_' + option"
                [formControlName]="field.name"
                [value]="option"
                class="form-radio"
              />
              <label [for]="field.name + '_' + option">{{ option }}</label>
            </div>
          </div>
        </ng-container>

        <ng-container *ngIf="field.type === 'select'">
          <select
            [id]="field.name"
            [formControlName]="field.name"
            class="form-select"
          >
            <option value="">Select an option</option>
            <option *ngFor="let option of field.options" [value]="option">
              {{ option }}
            </option>
          </select>
        </ng-container>

        <ng-container *ngIf="field.type === 'textarea'">
          <textarea
            [id]="field.name"
            [formControlName]="field.name"
            [placeholder]="field.placeholder || ''"
            class="form-textarea"
          ></textarea>
        </ng-container>

        <div *ngIf="form.get(field.name)?.invalid && form.get(field.name)?.touched" class="error-message">
          {{ getErrorMessage(field.name) }}
        </div>
      </div>

      <button type="submit">Submit</button>
    </form>
  </div>
</div>
